# Chapter 3: Saga Odyssey - Visual Diagrams

## Saga Effect Flow - The Cosmic Orchestra

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Action    â”‚      â”‚                     â”‚      â”‚    Store     â”‚
â”‚  Dispatch   â”‚â”€â”€â”€â”€â”€â–¶â”‚    Redux-Saga      â”‚â”€â”€â”€â”€â”€â–¶â”‚   Update     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  (Cosmic Center)    â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                     â”‚             â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
                     â”‚  â”‚   Watcher     â”‚  â”‚             â–¼
                     â”‚  â”‚   Sagas       â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  Component   â”‚
                     â”‚          â”‚          â”‚      â”‚   Re-render  â”‚
                     â”‚          â–¼          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                     â”‚  â”‚    Worker     â”‚  â”‚
                     â”‚  â”‚    Sagas      â”‚  â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â”‚          â”‚          â”‚
                     â”‚          â–¼          â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                     â”‚  â”‚   Effects:    â”‚  â”‚
                     â”‚  â”‚ â€¢ call()      â”‚  â”‚
                     â”‚  â”‚ â€¢ put()       â”‚  â”‚
                     â”‚  â”‚ â€¢ take()      â”‚  â”‚
                     â”‚  â”‚ â€¢ fork()      â”‚  â”‚
                     â”‚  â”‚ â€¢ spawn()     â”‚  â”‚
                     â”‚  â”‚ â€¢ race()      â”‚  â”‚
                     â”‚  â”‚ â€¢ select()    â”‚  â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Watcher Pattern Comparison - The Three Conductors

### takeEvery - The Enthusiastic Conductor
```
Actions:    A1â”€â”€A2â”€â”€A3â”€â”€A4â”€â”€A5â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Time
            â”‚   â”‚   â”‚   â”‚   â”‚
Workers:    W1  W2  W3  W4  W5
            â”‚   â”‚   â”‚   â”‚   â”‚
Complete:   â”€â”€â”€â”€C1â”€â”€C2â”€â”€C3â”€â”€C4â”€â”€C5â”€â”€â”€â–¶

Every action spawns a new worker. All run in parallel!
```

### takeLatest - The Perfectionist Conductor
```
Actions:    A1â”€â”€A2â”€â”€A3â”€â”€A4â”€â”€A5â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Time
            â”‚   âŒ  âŒ  âŒ  â”‚
Workers:    W1              W5
            â”‚               â”‚
Complete:   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€C5â”€â”€â”€â”€â”€â”€â”€â”€â–¶

New actions cancel previous workers. Only latest completes!
```

### takeLeading - The Patient Conductor
```
Actions:    A1â”€â”€A2â”€â”€A3â”€â”€A4â”€â”€A5â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Time
            â”‚   â¸ï¸  â¸ï¸  â¸ï¸  â¸ï¸
Workers:    W1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
            â”‚               â”‚
Complete:   â”€â”€â”€â”€â”€â”€â”€â”€â”€C1â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

First action blocks others until complete!
```

## Spawn Error Boundary - The Parallel Universes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROOT SAGA UNIVERSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Universe   â”‚  â”‚   Universe   â”‚            â”‚
â”‚  â”‚      A       â”‚  â”‚      B       â”‚            â”‚
â”‚  â”‚  (spawned)   â”‚  â”‚  (spawned)   â”‚            â”‚
â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚
â”‚  â”‚  â”‚ Tasks  â”‚  â”‚  â”‚  â”‚ Tasks  â”‚  â”‚            â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚
â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â”‚  ğŸ’¥ ERROR!   â”‚  â”‚     âœ… OK    â”‚            â”‚
â”‚  â”‚  (isolated)  â”‚  â”‚  (continues) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                  â”‚
â”‚  Root saga continues! Other universes safe! ğŸ›¡ï¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

spawn() = New universe (isolated)
fork() = Same universe (error propagates)
```

## Event Bus Architecture - The Quantum Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EVENT BUS (Multicast Channel)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚  ğŸ“¡ â†â”€â”€â”€â”€â”€â”€â”€ ğŸ“¡ â†â”€â”€â”€â”€â”€â”€â”€ ğŸ“¡ â†â”€â”€â”€â”€â”€â”€â”€ ğŸ“¡    â”‚   â”‚
â”‚  â”‚   â†“           â†“           â†“           â†“     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â†“           â†“           â†“           â†“         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Saga  â”‚  â”‚ Saga  â”‚  â”‚ Saga  â”‚  â”‚ Saga  â”‚      â”‚
â”‚  â”‚  A    â”‚  â”‚  B    â”‚  â”‚  C    â”‚  â”‚  D    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                     â”‚
â”‚  One event â†’ Multiple listeners                     â”‚
â”‚  Decoupled communication                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Race with Progress - The Quantum Race

```
â”Œâ”€â”€â”€â”€â”€â”€â”€ RACE START â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚
â”‚    ğŸ User Action        â”‚
â”‚           â”‚              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â–¼             â–¼       â”‚
â”‚  FORK 1        FORK 2    â”‚
â”‚  Loading       Actual    â”‚
â”‚  Animation     Work      â”‚
â”‚    â”‚             â”‚       â”‚
â”‚    â”‚ (100ms)    â”‚       â”‚
â”‚    â–¼             â”‚       â”‚
â”‚  Show           â”‚       â”‚
â”‚  Spinner        â”‚       â”‚
â”‚    â”‚             â–¼       â”‚
â”‚    â”‚          Complete   â”‚
â”‚    â”‚             â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â–¼               â”‚
â”‚     CANCEL LOSER         â”‚
â”‚     Hide Spinner         â”‚
â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Either work completes OR timeout shows spinner
Winner cancels loser!
```

## Optimistic Update Timeline - The Time Travel

```
Timeline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

T0: User clicks "Send"
    â”‚
    â”œâ”€â†’ Optimistic Update
    â”‚   â””â”€â†’ UI shows message immediately âœ¨
    â”‚
    â””â”€â†’ API Request
        â””â”€â†’ Server processing...

T1: Local state updated
    [Store: messages = [...old, optimisticMsg]]

T2: Server responds
    â”‚
    â”œâ”€â†’ Success: Replace optimistic with real
    â”‚   â””â”€â†’ [Deduplicate by tempId â†’ realId]
    â”‚
    â””â”€â†’ Failure: Rollback
        â””â”€â†’ [Remove optimistic, show error]

The Deduplication Magic:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Optimistic Msg â”‚â”€â”€â”€â–¶â”‚  Server Msg    â”‚
â”‚ tempId: tmp123 â”‚    â”‚ id: real456    â”‚
â”‚ status: sendingâ”‚    â”‚ status: sent   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€ Merged by matching content â”€â”€â”€â”€â”˜
```

## Matrix Event Processing - The Event Horizon

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MATRIX EVENT STREAM                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ E1 â†’ E2 â†’ E3 â†’ E4 â†’ E5 â†’ E6 â†’ E7 â†’ E8 â†’ ... â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚   Buffer    â”‚                            â”‚
â”‚         â”‚   Queue     â”‚                            â”‚
â”‚         â”‚ [][][][][] â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚   Event     â”‚                            â”‚
â”‚         â”‚  Channel    â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚    â–¼           â–¼           â–¼                       â”‚
â”‚ Process     Process    Process                     â”‚
â”‚ Message      Typing     Presence                   â”‚
â”‚  Saga        Saga       Saga                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Events queued during init â†’ No events lost!
```

## Background Task Scheduling - The Eternal Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCHEDULER SAGA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚  START â”€â”€â”                                  â”‚
â”‚          â–¼                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”Œâ”€â–¶â”‚ DELAY  â”‚ (configurable interval)     â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                             â”‚
â”‚  â”‚      â–¼                                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  â”‚ CHECK  â”‚ â†’ Any tasks pending?        â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                             â”‚
â”‚  â”‚      â–¼                                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  â”‚PROCESS â”‚â”€â”€â”€â”€â–¶â”‚ CLEANUP â”‚            â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ EXPIRED â”‚            â”‚
â”‚  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                             â”‚
â”‚  Runs forever (while(true))                â”‚
â”‚  Cancelled only on logout/unmount          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

These diagrams visualize the key saga patterns discovered in the zOS codebase, helping readers understand the "cosmic choreography" of asynchronous operations in Redux-Saga.